# C++ 风格指南 (Google C++ 风格)

## 1. 文件命名

### 1.1 头文件 (.h/.hpp)
```cpp
// 全小写，单词间用下划线分隔
class_name.h
my_utility_functions.h
network_manager.hpp
```

### 1.2 源文件 (.cpp/.cc)
```cpp
// 与头文件同名
class_name.cpp
my_utility_functions.cc
main.cc
```

### 1.3 内联文件 (.inc/.inl)
```cpp
// 内联定义文件
vector_operations.inc
template_implementations.inl
```

## 2. 目录命名

### 2.1 目录结构
```
project_name/           // 全小写，用下划线分隔
├── include/           // 公共头文件
│   └── project_name/  // 项目命名空间目录
├── src/              // 源文件
├── test/             // 测试文件
├── docs/             // 文档
├── third_party/      // 第三方依赖
└── build/           // 构建目录
```

## 3. 命名约定

### 3.1 通用原则
- 名称应具有描述性
- 避免缩写，除非是通用缩写
- 保持一致性

### 3.2 具体规范

#### 3.2.1 类、结构体、类型别名、枚举
```cpp
// 大驼峰命名法 (PascalCase)
class UrlTable { ... };
class UrlTableTester { ... };
struct UrlTableProperties { ... };
using PropertiesMap = std::map<std::string, std::string>;

// 枚举类型
enum class UrlTableError { ... };

// 模板类型参数
template <typename T>
class HashTable { ... };

template <typename Key, typename Value>
class Map { ... };
```

#### 3.2.2 变量
```cpp
// 普通变量：全小写，下划线分隔
std::string table_name;  // 好
int url_array_size;      // 好

// 类数据成员：以下划线结尾
class TableInfo {
 private:
  std::string table_name_;  // 好 - 下划线结尾
  static Pool<TableInfo>* pool_;  // 静态成员同样
};

// 结构体成员：普通变量命名（无下划线结尾）
struct UrlTableProperties {
  std::string name;
  int num_entries;
};
```

#### 3.2.3 常量
```cpp
// 命名空间作用域或类作用域的常量
const int kDaysInWeek = 7;
const std::string kCompanyName = "Google";

// 函数内局部常量
const int kBufferSize = 1024;
```

#### 3.2.4 函数
```cpp
// 常规函数：大驼峰命名法
AddTableEntry()
DeleteUrl()
OpenFileOrDie()

// 取值和设值函数
class MyClass {
 public:
  int get_num_entries() const { return num_entries_; }
  void set_num_entries(int num_entries) { num_entries_ = num_entries; }
  
 private:
  int num_entries_;
};
```

#### 3.2.5 命名空间
```cpp
// 全小写
namespace myproject {
namespace database {

class Database { ... };

}  // namespace database
}  // namespace myproject
```

#### 3.2.6 枚举值
```cpp
// 与常量相同：kEnumName
enum class UrlTableError {
  kOk = 0,
  kOutOfMemory,
  kMalformedInput,
};
```

## 4. 格式规范

### 4.1 缩进
```cpp
// 使用 2 个空格缩进
if (condition) {  // 左大括号不换行
  DoSomething();  // 2 个空格
} else {
  DoSomethingElse();
}
```

### 4.2 行长度
```cpp
// 每行最多 80 个字符
// 长表达式可以换行
if (this_one_thing > this_other_thing &&
    a_third_thing == a_fourth_thing &&
    yet_another && last_one) {
  ...
}
```

### 4.3 函数声明和定义
```cpp
// 返回类型在单独一行
ReturnType ClassName::FunctionName(Type par_name1, Type par_name2) {
  DoSomething();
  ...
}
```

## 5. 注释

### 5.1 文件注释
```cpp
// Copyright 2024 Your Company. All rights reserved.
//
// 文件描述
// 简要说明本文件的功能和内容
//
```

### 5.2 类注释
```cpp
// 迭代器，用于遍历 Foos 容器中的元素。迭代器是前向迭代器。
class FooIterator {
  ...
};
```

### 5.3 函数注释
```cpp
// 计算表格的边界。返回值是边界像素的数量，如果计算失败则返回 -1。
int CalculateTableBorder();
```

### 5.4 变量注释
```cpp
// 当前活动用户的 ID，如果没有活动用户则为 -1。
int active_user_id_;
```

## 6. 包含保护

### 6.1 头文件保护
```cpp
#ifndef FOO_BAR_BAZ_H_
#define FOO_BAR_BAZ_H_

...

#endif  // FOO_BAR_BAZ_H_
```

## 7. 包含顺序

```cpp
// 1. 关联的头文件
#include "foo/server/fooserver.h"

// 2. C 系统头文件
#include <sys/types.h>
#include <unistd.h>

// 3. C++ 标准库头文件
#include <vector>
#include <string>

// 4. 其他库头文件
#include <glog/logging.h>
#include <gflags/gflags.h>

// 5. 本项目头文件
#include "base/basictypes.h"
#include "base/commandlineflags.h"
```

## 8. 作用域

### 8.1 命名空间
```cpp
// 在 .cc 文件中使用未命名的命名空间
namespace {
// 内容
}  // namespace
```

### 8.2 局部变量
```cpp
// 尽可能缩小作用域
int i;
i = f();  // 不好 - 初始化与声明分离

int j = g();  // 好 - 声明时初始化
```

## 9. 类

### 9.1 访问控制顺序
```cpp
class MyClass {
 public:      // 公有接口
  MyClass();
  ~MyClass();
  
  void PublicMethod();
  
 protected:   // 保护接口
  void ProtectedMethod();
  
 private:     // 私有实现
  void PrivateMethod();
  int private_data_;
};
```

## 10. 现代 C++ 特性

### 10.1 智能指针
```cpp
std::unique_ptr<Foo> foo_ptr = std::make_unique<Foo>();
std::shared_ptr<Foo> shared_foo = std::make_shared<Foo>();
```

### 10.2 auto
```cpp
// 当类型明显或不重要时使用
auto it = my_map.find(key);
auto* ptr = new Foo();
const auto& ref = some_value;
```

### 10.3 范围 for
```cpp
for (const auto& item : container) {
  Process(item);
}
```

## 11. 完整示例

```cpp
// 文件: my_project/url_table.h
#ifndef MY_PROJECT_URL_TABLE_H_
#define MY_PROJECT_URL_TABLE_H_

#include <string>
#include <vector>
#include <memory>

namespace myproject {

// 表示 URL 表中的一行
class UrlTableRow {
 public:
  explicit UrlTableRow(const std::string& url);
  ~UrlTableRow();
  
  const std::string& url() const { return url_; }
  int visit_count() const { return visit_count_; }
  void IncrementVisitCount() { ++visit_count_; }
  
 private:
  std::string url_;
  int visit_count_ = 0;
};

// 管理 URL 表
class UrlTable {
 public:
  UrlTable();
  ~UrlTable();
  
  // 添加新 URL
  bool AddUrl(const std::string& url);
  
  // 获取所有 URL
  const std::vector<std::unique_ptr<UrlTableRow>>& urls() const {
    return urls_;
  }
  
  // 查找 URL
  UrlTableRow* FindUrl(const std::string& url);
  
  // 表是否为空
  bool empty() const { return urls_.empty(); }
  int size() const { return static_cast<int>(urls_.size()); }
  
 private:
  std::vector<std::unique_ptr<UrlTableRow>> urls_;
  
  // 禁用拷贝
  UrlTable(const UrlTable&) = delete;
  UrlTable& operator=(const UrlTable&) = delete;
};

}  // namespace myproject

#endif  // MY_PROJECT_URL_TABLE_H_
```

```cpp
// 文件: my_project/url_table.cc
#include "my_project/url_table.h"

#include <algorithm>

namespace myproject {

UrlTableRow::UrlTableRow(const std::string& url) : url_(url) {}

UrlTableRow::~UrlTableRow() = default;

UrlTable::UrlTable() = default;

UrlTable::~UrlTable() = default;

bool UrlTable::AddUrl(const std::string& url) {
  if (url.empty()) {
    return false;
  }
  
  // 检查是否已存在
  if (FindUrl(url) != nullptr) {
    return false;
  }
  
  urls_.push_back(std::make_unique<UrlTableRow>(url));
  return true;
}

UrlTableRow* UrlTable::FindUrl(const std::string& url) {
  auto it = std::find_if(urls_.begin(), urls_.end(),
                         const std::unique_ptr<UrlTableRow>& row {
                           return row->url() == url;
                         });
  return (it != urls_.end()) ? it->get() : nullptr;
}

}  // namespace myproject
```

## 12. 工具配置

### 12.1 .clang-format
```yaml
BasedOnStyle: Google
ColumnLimit: 80
IndentWidth: 2
```

### 12.2 使用工具
- clang-format: 自动格式化代码
- clang-tidy: 静态分析
- cpplint: 代码风格检查

---

**主要更改说明：**
1. 统一使用 Google C++ 风格的大驼峰命名法
2. 类成员变量以下划线结尾（而不是 m_ 前缀）
3. 常量以 k 开头
4. 缩进改为 2 个空格
5. 大括号风格改为左大括号不换行
6. 删除 getter/setter 的前缀，使用 get_/set_ 形式
7. 文件保护格式改为 `PROJECT_PATH_FILE_H_`
8. 包含顺序按 Google 规范
9. 函数声明返回类型单独一行
10. 枚举值以 k 开头