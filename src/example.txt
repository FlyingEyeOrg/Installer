#include <Windows.h>
#include <iostream>
#include <commctrl.h>
#include <string>
#include <map>

#define MAX_LOADSTRING 100

// 控件 ID 定义
#define ID_BUTTON_1          1001
#define ID_BUTTON_2          1002
#define ID_EDITBOX           1003
#define ID_LISTBOX           1004
#define ID_COMBOBOX          1005
#define ID_CHECKBOX          1006
#define ID_RADIO_1           1007
#define ID_RADIO_2           1008
#define ID_RADIO_3           1009
#define ID_GROUPBOX          1010
#define ID_PROGRESSBAR       1011
#define ID_TRACKBAR          1012
#define ID_UPDOWN            1013
#define ID_DATETIME_PICKER   1014
#define ID_MONTH_CALENDAR    1015
#define ID_IP_ADDRESS        1016
#define ID_HOTKEY            1017
#define ID_TAB_CONTROL       1018
#define ID_TREEVIEW          1019
#define ID_LISTVIEW          1020
#define ID_STATUSBAR         1021
#define ID_EDIT_SPIN         1022

// 页面控件ID
#define ID_PAGE1             1101
#define ID_PAGE2             1102
#define ID_PAGE3             1103

// 全局变量
HINSTANCE hInst;
WCHAR szTitle[MAX_LOADSTRING] = L"完整的 Win32 控件演示";
WCHAR szWindowClass[MAX_LOADSTRING] = L"CompleteControlsDemo";

// 控件句柄
std::map<int, HWND> g_controls;

// 字体句柄
HFONT g_hFont = nullptr;

// 布局常量
const int WINDOW_WIDTH = 1200;
const int WINDOW_HEIGHT = 800;
const int MARGIN = 20;
const int COLUMN_WIDTH = 350;
const int ROW_HEIGHT = 25;
const int SPACING = 10;

// 函数声明
ATOM MyRegisterClass(HINSTANCE hInstance);
BOOL InitInstance(HINSTANCE, int);
LRESULT CALLBACK WndProc(HWND, UINT, WPARAM, LPARAM);
void CreateAllControls(HWND hWnd);
void InitializeControls(HWND hWnd);
void AddControl(HWND hWnd, LPCWSTR className, LPCWSTR text, DWORD style, 
                int x, int y, int width, int height, int id);
void OnButtonClick(HWND hWnd, int buttonId);
void OnSelectionChange(HWND hWnd, int controlId);
void CreateTabPages(HWND hTab);
void ShowTabPage(int pageIndex);
void CreateFont();
void SetFontForControl(HWND hWnd);

int APIENTRY wWinMain(_In_ HINSTANCE hInstance,
                     _In_opt_ HINSTANCE hPrevInstance,
                     _In_ LPWSTR lpCmdLine,
                     _In_ int nCmdShow)
{
    UNREFERENCED_PARAMETER(hPrevInstance);
    UNREFERENCED_PARAMETER(lpCmdLine);

    // 初始化通用控件
    INITCOMMONCONTROLSEX icex;
    icex.dwSize = sizeof(INITCOMMONCONTROLSEX);
    icex.dwICC = ICC_WIN95_CLASSES | ICC_DATE_CLASSES | ICC_INTERNET_CLASSES;
    InitCommonControlsEx(&icex);

    // 注册窗口类
    MyRegisterClass(hInstance);

    // 创建窗口
    if (!InitInstance(hInstance, nCmdShow))
    {
        return FALSE;
    }

    // 主消息循环
    MSG msg;
    while (GetMessage(&msg, nullptr, 0, 0))
    {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    // 清理字体资源
    if (g_hFont)
    {
        DeleteObject(g_hFont);
    }

    return (int)msg.wParam;
}

// 创建微软雅黑字体
void CreateFont()
{
    if (!g_hFont)
    {
        g_hFont = CreateFontW(
            18,                           // 字体高度
            0,                            // 字体宽度
            0,                            // 文本倾斜度
            0,                            // 字体倾斜度
            FW_NORMAL,                    // 字体粗细
            FALSE,                        // 是否斜体
            FALSE,                        // 是否下划线
            FALSE,                        // 是否删除线
            DEFAULT_CHARSET,              // 字符集
            OUT_DEFAULT_PRECIS,           // 输出精度
            CLIP_DEFAULT_PRECIS,          // 裁剪精度
            CLEARTYPE_QUALITY,            // 输出质量（ClearType抗锯齿）
            DEFAULT_PITCH | FF_DONTCARE,  // 字间距和字族
            L"微软雅黑"                   // 字体名称
        );
    }
}

// 为控件设置字体
void SetFontForControl(HWND hWnd)
{
    if (g_hFont && hWnd)
    {
        SendMessage(hWnd, WM_SETFONT, (WPARAM)g_hFont, TRUE);
    }
}

// 注册窗口类
ATOM MyRegisterClass(HINSTANCE hInstance)
{
    WNDCLASSEXW wcex = {};
    wcex.cbSize = sizeof(WNDCLASSEXW);
    wcex.style = CS_HREDRAW | CS_VREDRAW;
    wcex.lpfnWndProc = WndProc;
    wcex.hInstance = hInstance;
    wcex.hIcon = LoadIconW(nullptr, (LPCWSTR)IDI_APPLICATION);
    wcex.hCursor = LoadCursorW(nullptr, (LPCWSTR)IDC_ARROW);
    wcex.hbrBackground = (HBRUSH)(COLOR_3DFACE + 1);
    wcex.lpszClassName = szWindowClass;
    wcex.hIconSm = LoadIconW(nullptr, (LPCWSTR)IDI_APPLICATION);

    return RegisterClassExW(&wcex);
}

// 创建窗口实例
BOOL InitInstance(HINSTANCE hInstance, int nCmdShow)
{
    hInst = hInstance;

    // 创建字体
    CreateFont();

    HWND hWnd = CreateWindowW(szWindowClass, szTitle,
                              WS_OVERLAPPEDWINDOW,
                              CW_USEDEFAULT, 0, WINDOW_WIDTH, WINDOW_HEIGHT,
                              nullptr, nullptr, hInstance, nullptr);

    if (!hWnd)
    {
        return FALSE;
    }

    ShowWindow(hWnd, nCmdShow);
    UpdateWindow(hWnd);

    return TRUE;
}

// 添加控件的辅助函数
void AddControl(HWND hWnd, LPCWSTR className, LPCWSTR text, DWORD style,
                int x, int y, int width, int height, int id)
{
    HWND hControl = CreateWindowW(className, text,
                                  WS_CHILD | WS_VISIBLE | style,
                                  x, y, width, height,
                                  hWnd, (HMENU)(INT_PTR)id, hInst, nullptr);
    if (hControl)
    {
        if (id != 0)
        {
            g_controls[id] = hControl;
        }
        // 为所有控件设置微软雅黑字体
        SetFontForControl(hControl);
    }
}

// 创建标签页内容
void CreateTabPages(HWND hTab)
{
    RECT rcTab;
    GetClientRect(hTab, &rcTab);
    TabCtrl_AdjustRect(hTab, FALSE, &rcTab);
    
    int pageWidth = rcTab.right - rcTab.left;
    int pageHeight = rcTab.bottom - rcTab.top;
    
    // 页面1
    HWND hPage1 = CreateWindowW(L"STATIC", L"",
                               WS_CHILD | WS_VISIBLE,
                               rcTab.left, rcTab.top, pageWidth, pageHeight,
                               hTab, (HMENU)ID_PAGE1, hInst, nullptr);
    g_controls[ID_PAGE1] = hPage1;
    SetFontForControl(hPage1);
    
    // 页面1内容
    HWND hPage1Text = CreateWindowW(L"STATIC", L"页面1内容区域\n\n这是第一个标签页\n可以放置相关控件和内容\n\n当前页面: 基本信息",
                                   WS_CHILD | WS_VISIBLE | SS_CENTER,
                                   10, 30, pageWidth - 20, 120, hPage1, nullptr, hInst, nullptr);
    SetFontForControl(hPage1Text);
    
    // 页面2
    HWND hPage2 = CreateWindowW(L"STATIC", L"",
                               WS_CHILD,
                               rcTab.left, rcTab.top, pageWidth, pageHeight,
                               hTab, (HMENU)ID_PAGE2, hInst, nullptr);
    g_controls[ID_PAGE2] = hPage2;
    SetFontForControl(hPage2);
    
    // 页面2内容
    HWND hPage2Text = CreateWindowW(L"STATIC", L"页面2内容区域\n\n这是第二个标签页\n用于显示高级设置\n\n当前页面: 配置选项",
                                   WS_CHILD | WS_VISIBLE | SS_CENTER,
                                   10, 30, pageWidth - 20, 120, hPage2, nullptr, hInst, nullptr);
    SetFontForControl(hPage2Text);
    
    // 页面3
    HWND hPage3 = CreateWindowW(L"STATIC", L"",
                               WS_CHILD,
                               rcTab.left, rcTab.top, pageWidth, pageHeight,
                               hTab, (HMENU)ID_PAGE3, hInst, nullptr);
    g_controls[ID_PAGE3] = hPage3;
    SetFontForControl(hPage3);
    
    // 页面3内容
    HWND hPage3Text = CreateWindowW(L"STATIC", L"页面3内容区域\n\n这是第三个标签页\n显示帮助和关于信息\n\n当前页面: 关于",
                                   WS_CHILD | WS_VISIBLE | SS_CENTER,
                                   10, 30, pageWidth - 20, 120, hPage3, nullptr, hInst, nullptr);
    SetFontForControl(hPage3Text);
    
    // 初始显示页面1
    ShowWindow(hPage1, SW_SHOW);
    ShowWindow(hPage2, SW_HIDE);
    ShowWindow(hPage3, SW_HIDE);
}

// 显示指定标签页
void ShowTabPage(int pageIndex)
{
    for (int i = 1; i <= 3; i++)
    {
        HWND hPage = g_controls[ID_PAGE1 + i - 1];
        if (hPage)
        {
            ShowWindow(hPage, (i == pageIndex) ? SW_SHOW : SW_HIDE);
        }
    }
}

// 创建所有控件 - 根据图片精确匹配
void CreateAllControls(HWND hWnd)
{
    int x, y;
    
    // === 第一列：基本控件 ===
    x = MARGIN;
    y = MARGIN;
    
    // 1. 标题
    AddControl(hWnd, L"STATIC", L"===基本控件===", SS_LEFT | SS_CENTERIMAGE, 
               x, y, COLUMN_WIDTH - 40, ROW_HEIGHT, 0);
    y += ROW_HEIGHT + SPACING;
    
    // 2. 按钮
    AddControl(hWnd, L"BUTTON", L"普通按钮", BS_PUSHBUTTON, 
               x, y, 120, ROW_HEIGHT, ID_BUTTON_1);
    AddControl(hWnd, L"BUTTON", L"默认按钮", BS_DEFPUSHBUTTON, 
               x + 130, y, 120, ROW_HEIGHT, ID_BUTTON_2);
    y += ROW_HEIGHT + SPACING;
    
    // 3. 单行文本框
    AddControl(hWnd, L"STATIC", L"单行文本:", SS_RIGHT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, L"EDIT", L"可编辑文本", WS_BORDER | ES_AUTOHSCROLL, 
               x + 90, y, 200, ROW_HEIGHT, ID_EDITBOX);
    y += ROW_HEIGHT + SPACING;
    
    // 4. 多行文本框
    AddControl(hWnd, L"STATIC", L"多行文本:", SS_RIGHT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, L"EDIT", L"多行文本输入区域", 
               WS_BORDER | ES_MULTILINE | ES_AUTOVSCROLL | WS_VSCROLL,
               x + 90, y, 200, 60, 0);
    y += 70;
    
    // 5. 复选框和单选按钮
    AddControl(hWnd, L"BUTTON", L"复选框选项", BS_AUTOCHECKBOX, 
               x, y, 120, ROW_HEIGHT, ID_CHECKBOX);
    y += ROW_HEIGHT + SPACING;
    
    AddControl(hWnd, L"BUTTON", L"单选按钮1", BS_AUTORADIOBUTTON | WS_GROUP, 
               x, y, 100, ROW_HEIGHT, ID_RADIO_1);
    AddControl(hWnd, L"BUTTON", L"单选按钮2", BS_AUTORADIOBUTTON, 
               x + 110, y, 100, ROW_HEIGHT, ID_RADIO_2);
    AddControl(hWnd, L"BUTTON", L"单选按钮3", BS_AUTORADIOBUTTON, 
               x + 220, y, 100, ROW_HEIGHT, ID_RADIO_3);
    y += ROW_HEIGHT + SPACING;
    
    // 6. 分组框
    int groupBoxWidth = 320;
    int groupBoxHeight = 100;
    AddControl(hWnd, L"BUTTON", L"设置分组", BS_GROUPBOX, 
               x, y, groupBoxWidth, groupBoxHeight, ID_GROUPBOX);
    
    // 分组框内的控件 - 根据图片精确布局
    int groupInnerX = x + 15;
    int groupInnerY = y + 25;
    
    AddControl(hWnd, L"STATIC", L"组内文本:", SS_RIGHT | SS_CENTERIMAGE, 
               groupInnerX, groupInnerY, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, L"EDIT", L"组内编辑框", WS_BORDER, 
               groupInnerX + 90, groupInnerY, 150, ROW_HEIGHT, 0);
    AddControl(hWnd, L"BUTTON", L"组内按钮", BS_PUSHBUTTON, 
               groupInnerX + 250, groupInnerY, 60, ROW_HEIGHT, 0);
    y += groupBoxHeight + SPACING;
    
    // 7. 列表框
    AddControl(hWnd, L"STATIC", L"列表框:", SS_LEFT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, L"LISTBOX", L"", WS_BORDER | LBS_NOTIFY, 
               x, y + 25, 320, 100, ID_LISTBOX);
    y += 130;
    
    // 8. 组合框
    AddControl(hWnd, L"STATIC", L"下拉框:", SS_LEFT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, L"COMBOBOX", L"", WS_BORDER | CBS_DROPDOWNLIST, 
               x + 90, y, 200, 200, ID_COMBOBOX);
    y += ROW_HEIGHT + SPACING;
    
    // === 第二列：高级控件 ===
    x = MARGIN + COLUMN_WIDTH + 20;
    y = MARGIN;
    
    // 1. 标题
    AddControl(hWnd, L"STATIC", L"===高级控件===", SS_LEFT | SS_CENTERIMAGE, 
               x, y, COLUMN_WIDTH - 40, ROW_HEIGHT, 0);
    y += ROW_HEIGHT + SPACING;
    
    // 2. 进度条
    AddControl(hWnd, L"STATIC", L"进度条:", SS_RIGHT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, PROGRESS_CLASSW, L"", 0, 
               x + 90, y, 200, 20, ID_PROGRESSBAR);
    y += ROW_HEIGHT + SPACING;
    
    // 3. 滑动条
    AddControl(hWnd, L"STATIC", L"滑动条:", SS_RIGHT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, TRACKBAR_CLASSW, L"", TBS_AUTOTICKS | TBS_HORZ, 
               x + 90, y, 200, 30, ID_TRACKBAR);
    y += 40;
    
    // 4. 数值调节
    AddControl(hWnd, L"STATIC", L"数值调节:", SS_RIGHT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    
    // 创建数值调节控件
    HWND hEditSpin = CreateWindowW(L"EDIT", L"57", WS_BORDER | ES_NUMBER | WS_VISIBLE | WS_CHILD,
                                   x + 90, y, 100, ROW_HEIGHT, hWnd, (HMENU)ID_EDIT_SPIN, hInst, nullptr);
    SetFontForControl(hEditSpin);
    
    HWND hUpDown = CreateWindowW(UPDOWN_CLASSW, L"", 
                                 WS_CHILD | WS_VISIBLE | UDS_SETBUDDYINT | UDS_ALIGNRIGHT,
                                 0, 0, 0, 0, hWnd, (HMENU)ID_UPDOWN, hInst, nullptr);
    SendMessage(hUpDown, UDM_SETBUDDY, (WPARAM)hEditSpin, 0);
    SendMessage(hUpDown, UDM_SETRANGE, 0, MAKELPARAM(100, 0));
    SendMessage(hUpDown, UDM_SETPOS, 0, 57);
    y += ROW_HEIGHT + SPACING;
    
    // 5. 日期时间选择器
    AddControl(hWnd, L"STATIC", L"日期时间:", SS_RIGHT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, DATETIMEPICK_CLASSW, L"", DTS_SHORTDATEFORMAT, 
               x + 90, y, 200, ROW_HEIGHT, ID_DATETIME_PICKER);
    y += ROW_HEIGHT + SPACING;
    
    // 6. 月历控件
    AddControl(hWnd, L"STATIC", L"月历:", SS_LEFT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, MONTHCAL_CLASSW, L"", MCS_DAYSTATE, 
               x, y + 25, 300, 160, ID_MONTH_CALENDAR);
    y += 190;
    
    // 7. IP地址控件
    AddControl(hWnd, L"STATIC", L"IP地址:", SS_RIGHT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, WC_IPADDRESSW, L"", 0, 
               x + 90, y, 200, ROW_HEIGHT, ID_IP_ADDRESS);
    y += ROW_HEIGHT + SPACING;
    
    // 8. 热键控件
    AddControl(hWnd, L"STATIC", L"热键:", SS_RIGHT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, HOTKEY_CLASSW, L"", 0, 
               x + 90, y, 200, ROW_HEIGHT, ID_HOTKEY);
    y += ROW_HEIGHT + SPACING;
    
    // === 第三列：容器控件 ===
    x = MARGIN + (COLUMN_WIDTH + 20) * 2;
    y = MARGIN;
    
    // 1. 标题
    AddControl(hWnd, L"STATIC", L"===容器控件===", SS_LEFT | SS_CENTERIMAGE, 
               x, y, COLUMN_WIDTH - 40, ROW_HEIGHT, 0);
    y += ROW_HEIGHT + SPACING;
    
    // 2. 标签页控件
    AddControl(hWnd, WC_TABCONTROLW, L"", TCS_FIXEDWIDTH, 
               x, y, 320, 200, ID_TAB_CONTROL);
    
    // 添加标签页
    HWND hTab = g_controls[ID_TAB_CONTROL];
    TCITEM tie = {};
    tie.mask = TCIF_TEXT;
    const wchar_t* tabs[] = {L"页面1", L"页面2", L"页面3"};
    for (int i = 0; i < 3; i++)
    {
        tie.pszText = const_cast<wchar_t*>(tabs[i]);
        TabCtrl_InsertItem(hTab, i, &tie);
    }
    
    // 创建标签页内容
    CreateTabPages(hTab);
    y += 210;
    
    // 3. 树形视图
    AddControl(hWnd, L"STATIC", L"树形视图:", SS_LEFT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, WC_TREEVIEWW, L"", WS_BORDER | TVS_HASBUTTONS | TVS_LINESATROOT, 
               x, y + 25, 320, 150, ID_TREEVIEW);
    y += 180;
    
    // 4. 列表视图
    AddControl(hWnd, L"STATIC", L"列表视图:", SS_LEFT | SS_CENTERIMAGE, 
               x, y, 80, ROW_HEIGHT, 0);
    AddControl(hWnd, WC_LISTVIEWW, L"", WS_BORDER | LVS_REPORT, 
               x, y + 25, 320, 150, ID_LISTVIEW);
    y += 180;
    
    // === 状态栏 ===
    HWND hStatusBar = CreateWindowExW(0, STATUSCLASSNAMEW, L"", 
                                      WS_CHILD | WS_VISIBLE | SBARS_SIZEGRIP,
                                      0, 0, 0, 0, hWnd, (HMENU)ID_STATUSBAR, hInst, nullptr);
    g_controls[ID_STATUSBAR] = hStatusBar;
    SetFontForControl(hStatusBar);
    
    // 设置状态栏分区
    int parts[] = {300, 600, 900, -1};
    SendMessage(hStatusBar, SB_SETPARTS, 4, (LPARAM)parts);
    SendMessage(hStatusBar, SB_SETTEXT, 0, (LPARAM)L"就绪");
    SendMessage(hStatusBar, SB_SETTEXT, 1, (LPARAM)L"Win32 控件演示");
    SendMessage(hStatusBar, SB_SETTEXT, 2, (LPARAM)L"所有控件已加载");
}

// 初始化控件数据 - 根据图片精确设置
void InitializeControls(HWND hWnd)
{
    // 初始化列表框
    HWND hListBox = g_controls[ID_LISTBOX];
    if (hListBox)
    {
        SendMessage(hListBox, LB_ADDSTRING, 0, (LPARAM)L"列表项 1");
        SendMessage(hListBox, LB_ADDSTRING, 0, (LPARAM)L"列表项 2");
        SendMessage(hListBox, LB_ADDSTRING, 0, (LPARAM)L"列表项 3");
        SendMessage(hListBox, LB_SETCURSEL, 0, 0);
    }

    // 初始化组合框
    HWND hComboBox = g_controls[ID_COMBOBOX];
    if (hComboBox)
    {
        SendMessage(hComboBox, CB_ADDSTRING, 0, (LPARAM)L"选项A");
        SendMessage(hComboBox, CB_ADDSTRING, 0, (LPARAM)L"选项B");
        SendMessage(hComboBox, CB_ADDSTRING, 0, (LPARAM)L"选项C");
        SendMessage(hComboBox, CB_SETCURSEL, 1, 0); // 默认选中选项B
    }

    // 初始化进度条
    HWND hProgress = g_controls[ID_PROGRESSBAR];
    if (hProgress)
    {
        SendMessage(hProgress, PBM_SETRANGE, 0, MAKELPARAM(0, 100));
        SendMessage(hProgress, PBM_SETPOS, 75, 0);
    }

    // 初始化滑动条
    HWND hTrackbar = g_controls[ID_TRACKBAR];
    if (hTrackbar)
    {
        SendMessage(hTrackbar, TBM_SETRANGE, TRUE, MAKELPARAM(0, 100));
        SendMessage(hTrackbar, TBM_SETPOS, TRUE, 50);
        SendMessage(hTrackbar, TBM_SETPAGESIZE, 0, 10);
    }

    // 初始化日期时间选择器
    HWND hDateTime = g_controls[ID_DATETIME_PICKER];
    if (hDateTime)
    {
        SYSTEMTIME st = {};
        st.wYear = 2025;
        st.wMonth = 12;
        st.wDay = 1;
        DateTime_SetSystemtime(hDateTime, GDT_VALID, &st);
    }

    // 初始化月历控件
    HWND hMonthCal = g_controls[ID_MONTH_CALENDAR];
    if (hMonthCal)
    {
        SYSTEMTIME st = {};
        st.wYear = 2025;
        st.wMonth = 12;
        st.wDay = 1;
        MonthCal_SetCurSel(hMonthCal, &st);
    }

    // 初始化IP地址控件
    HWND hIPAddress = g_controls[ID_IP_ADDRESS];
    if (hIPAddress)
    {
        SendMessage(hIPAddress, IPM_SETADDRESS, 0, MAKEIPADDRESS(192, 168, 1, 1));
    }

    // 初始化树形视图
    HWND hTreeView = g_controls[ID_TREEVIEW];
    if (hTreeView)
    {
        TVINSERTSTRUCT tvis = {};
        tvis.hParent = TVI_ROOT;
        tvis.hInsertAfter = TVI_LAST;
        tvis.item.mask = TVIF_TEXT;
        
        tvis.item.pszText = const_cast<wchar_t*>(L"根节点");
        HTREEITEM hRoot = TreeView_InsertItem(hTreeView, &tvis);
        
        tvis.hParent = hRoot;
        tvis.item.pszText = const_cast<wchar_t*>(L"子节点 1");
        TreeView_InsertItem(hTreeView, &tvis);
        
        tvis.item.pszText = const_cast<wchar_t*>(L"子节点 2");
        TreeView_InsertItem(hTreeView, &tvis);
    }

    // 初始化列表视图
    HWND hListView = g_controls[ID_LISTVIEW];
    if (hListView)
    {
        // 添加列
        LVCOLUMN lvc = {};
        lvc.mask = LVCF_TEXT | LVCF_WIDTH;
        lvc.pszText = const_cast<wchar_t*>(L"列1");
        lvc.cx = 100;
        ListView_InsertColumn(hListView, 0, &lvc);
        
        lvc.pszText = const_cast<wchar_t*>(L"列2");
        lvc.cx = 100;
        ListView_InsertColumn(hListView, 1, &lvc);
        
        lvc.pszText = const_cast<wchar_t*>(L"列3");
        lvc.cx = 100;
        ListView_InsertColumn(hListView, 2, &lvc);

        // 添加行
        for (int i = 0; i < 5; i++)
        {
            LVITEM lvi = {};
            lvi.mask = LVIF_TEXT;
            lvi.iItem = i;
            lvi.iSubItem = 0;
            wchar_t text[50];
            swprintf(text, 50, L"行 %d-1", i + 1);
            lvi.pszText = text;
            ListView_InsertItem(hListView, &lvi);
            
            swprintf(text, 50, L"行 %d-2", i + 1);
            ListView_SetItemText(hListView, i, 1, text);
            
            swprintf(text, 50, L"行 %d-3", i + 1);
            ListView_SetItemText(hListView, i, 2, text);
        }
    }

    // 设置单选按钮默认选中
    SendMessage(g_controls[ID_RADIO_1], BM_SETCHECK, BST_CHECKED, 0);
}

// 按钮点击处理
void OnButtonClick(HWND hWnd, int buttonId)
{
    switch (buttonId)
    {
    case ID_BUTTON_1:
        {
            wchar_t buffer[256];
            GetWindowText(g_controls[ID_EDITBOX], buffer, 256);
            
            std::wstring message = L"按钮1被点击！\n";
            message += L"文本框内容: ";
            message += buffer;
            
            // 更新进度条
            static int progress = 0;
            progress = (progress + 10) % 110;
            SendMessage(g_controls[ID_PROGRESSBAR], PBM_SETPOS, progress, 0);
            
            MessageBoxW(hWnd, message.c_str(), L"按钮点击", MB_OK);
        }
        break;
        
    case ID_BUTTON_2:
        {
            BOOL checked = SendMessage(g_controls[ID_CHECKBOX], BM_GETCHECK, 0, 0);
            std::wstring message = checked ? L"复选框已选中！" : L"复选框未选中！";
            MessageBoxW(hWnd, message.c_str(), L"按钮2", MB_OK);
        }
        break;
    }
}

// 选择改变处理
void OnSelectionChange(HWND hWnd, int controlId)
{
    switch (controlId)
    {
    case ID_LISTBOX:
        {
            int index = SendMessage(g_controls[ID_LISTBOX], LB_GETCURSEL, 0, 0);
            if (index != LB_ERR)
            {
                wchar_t text[100];
                SendMessage(g_controls[ID_LISTBOX], LB_GETTEXT, index, (LPARAM)text);
                
                // 更新状态栏
                HWND hStatusBar = g_controls[ID_STATUSBAR];
                SendMessage(hStatusBar, SB_SETTEXT, 0, (LPARAM)text);
            }
        }
        break;
        
    case ID_COMBOBOX:
        {
            int index = SendMessage(g_controls[ID_COMBOBOX], CB_GETCURSEL, 0, 0);
            if (index != CB_ERR)
            {
                wchar_t text[100];
                SendMessage(g_controls[ID_COMBOBOX], CB_GETLBTEXT, index, (LPARAM)text);
                
                std::wstring message = L"选择了: ";
                message += text;
                SendMessage(g_controls[ID_LISTBOX], LB_ADDSTRING, 0, (LPARAM)message.c_str());
            }
        }
        break;
    }
}

// 窗口过程函数
LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)
{
    switch (message)
    {
    case WM_NOTIFY:
        {
            LPNMHDR nmhdr = (LPNMHDR)lParam;
            
            // 处理标签页切换
            if (nmhdr->code == TCN_SELCHANGE && nmhdr->idFrom == ID_TAB_CONTROL)
            {
                int selected = TabCtrl_GetCurSel(g_controls[ID_TAB_CONTROL]);
                ShowTabPage(selected + 1);
            }
        }
        break;

    case WM_CREATE:
        CreateAllControls(hWnd);
        InitializeControls(hWnd);
        break;

    case WM_COMMAND:
        {
            int wmId = LOWORD(wParam);
            int wmEvent = HIWORD(wParam);
            
            // 处理按钮点击
            if (wmEvent == BN_CLICKED)
            {
                OnButtonClick(hWnd, wmId);
            }
            // 处理选择改变
            else if (wmEvent == LBN_SELCHANGE || wmEvent == CBN_SELCHANGE)
            {
                OnSelectionChange(hWnd, wmId);
            }
            // 处理列表框双击
            else if (wmEvent == LBN_DBLCLK && wmId == ID_LISTBOX)
            {
                int index = SendMessage(g_controls[ID_LISTBOX], LB_GETCURSEL, 0, 0);
                if (index != LB_ERR)
                {
                    wchar_t text[100];
                    SendMessage(g_controls[ID_LISTBOX], LB_GETTEXT, index, (LPARAM)text);
                    MessageBoxW(hWnd, text, L"列表框双击", MB_OK);
                }
            }
        }
        break;

    case WM_HSCROLL:
        {
            if (LOWORD(wParam) == SB_THUMBTRACK && g_controls.find(ID_TRACKBAR) != g_controls.end())
            {
                if ((HWND)lParam == g_controls[ID_TRACKBAR])
                {
                    int pos = HIWORD(wParam);
                    wchar_t text[50];
                    swprintf(text, 50, L"滑动条位置: %d", pos);
                    
                    // 更新状态栏
                    HWND hStatusBar = g_controls[ID_STATUSBAR];
                    SendMessage(hStatusBar, SB_SETTEXT, 1, (LPARAM)text);
                }
            }
        }
        break;

    case WM_SIZE:
        {
            // 调整状态栏大小
            HWND hStatusBar = g_controls[ID_STATUSBAR];
            if (hStatusBar)
            {
                SendMessage(hStatusBar, WM_SIZE, 0, 0);
            }
        }
        break;

    case WM_DESTROY:
        PostQuitMessage(0);
        break;

    default:
        return DefWindowProcW(hWnd, message, wParam, lParam);
    }
    return 0;
}